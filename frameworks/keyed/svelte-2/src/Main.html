<script>
  import Button from './Button.html';
  import Row from './Row.html';
  import GlyphIcon from './GlyphIcon.html';

  let seed = 0;
  // random function is replaced to remove any randomness from the benchmark.
  const random = (max) => seed++ % max;
  const A = ["pretty", "large", "big", "small", "tall", "short", "long", "handsome", "plain", "quaint", "clean",
      "elegant", "easy", "angry", "crazy", "helpful", "mushy", "odd", "unsightly", "adorable", "important",
      "inexpensive", "cheap", "expensive", "fancy"];
  const C = ["red", "yellow", "blue", "green", "pink", "brown", "purple", "brown", "white", "black", "orange"];
  const N = ["table", "chair", "house", "bbq", "desk", "car", "pony", "cookie", "sandwich", "burger", "pizza",
      "mouse", "keyboard"];

  let nextId = 1;
  let data = [];
  let selected = -1;
  function buildData(count) {
      const data = Array(count);
      for (let i = 0; i < count; i++) {
          data[i] = { id: nextId++, label: `${A[random(A.length)]} ${C[random(C.length)]} ${N[random(N.length)]}` };
      }
      return data;
  }

  const add = () => {
      data = data.concat(buildData(1000));
  };
  const clear = () => {
      data = [];
      selected = 0;
  };
  const partialUpdate = () => {
      for (let i = 0; i < data.length; i += 10) {
          data[i].label += ' !!!';
      }
  };
  const remove = (id) => {
      const idx = data.findIndex((item) => item.id === id);
      data = data.slice();
      data.splice(idx, 1);
  };
  const run = () => {
      data = buildData(1000);
      selected = 0;
  };
  const runLots = () => {
      data = buildData(10000);
      selected = 0;
  };
  const select = (id) => {
      selected = id;
  };
  const swapRows = () => {
      if (data.length > 998) {
          data = data.slice();
          const tmp = data[1];
          data[1] = data[998];
          data[998] = tmp;
      }
  };
  const click = ({ target }) => {
      const id = Number.parseInt(target.closest("tr").firstChild.firstChild.nodeValue);
      if (target.matches(".glyphicon-remove")) {
          remove(id);
      } else {
          select(id);
      }
  };
</script>

<div class="jumbotron">
  <div class="row">
      <div class="col-md-6">
          <h1>Svelte (keyed)</h1>
      </div>
      <div class="col-md-6">
          <div class="row">
              <Button id="run" title="Create 1,000 rows" cb={run} />
              <Button id="runlots" title="Create 10,000 rows" cb={runLots} />
              <Button id="add" title="Append 1,000 rows" cb={add} />
              <Button id="update" title="Update every 10th row" cb={partialUpdate} />
              <Button id="clear" title="Clear" cb={clear} />
              <Button id="swaprows" title="Swap rows" cb={swapRows} />
          </div>
      </div>
  </div>
</div>
<table class="table table-hover table-striped test-data">
  <tbody on:click={click}>
      {#each data as row, num (row.id)}
      <Row id={row.id} label={row.label} selected={row.id === selected} />
      {/each}
  </tbody>
</table>
<GlyphIcon preload={true} />